<h2>ショッピングカート</h2>
<div class = "row">

 <%= link_to "カートを空にする", destroy_all_cart_items_path, method: :delete, data: {confirm: "本当に消しますか？"}, class:"btn btn-danger" %>


 <%= link_to "買い物を続ける", items_path,class:"btn btn-success" %>

</div>
 <table class="table table-hover table-inverse">
  <thead>
   <tr>
       <th>商品名</th>
       <th>単価</th>
       <th>数量</th>
       <th>小計</th>
       <th></th>
   </tr>
  </thead>
  <tbody>
<% @sum = 0 %>
<% @cart_item.each do |cart_item| %>
   <tr>
    <td><%= cart_item.item.name %></td>
    <td><%= converting_to_jpy(cart_item.item.add_tax_price) %></td>
    <td>
      <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch, local: true do |f| %>
      <%#= f.hidden_field :item_id, value: @item.id %>
       <%= f.select :amount, [[1], [2], [3], [4],[5]] %>
       <%= f.submit '変更' %>
       <% end %>
     <%#= link_to "変更", cart_item.amount(@cart_item), method: :patch, class:"btn btn-success" %>
     </td>
    <td>
     <%= converting_to_jpy(cart_item.item.add_tax_price * cart_item.amount) %>
     <!--ここはsum+=sub_total　と%= sub_total -->
    </td>
    <td><%= link_to "カートから削除", cart_item_path(cart_item), method: :delete, data: {confirm: "本当に消しますか？"}, class:"btn btn-danger" %></td>
    </tr>
    <% @sum += cart_item.item.add_tax_price * cart_item.amount %>
   </tbody>
 <% end %>
 </table>
 <table class="table table-hover table-inverse">
   <tbody>
    <tr>
      <th>合計金額</th>
     <th>
      <%= converting_to_jpy(@sum) %>
      </th>
    </tr>
 </table>
 <div class="mx-auto" style="width: 200px;">
 <%= link_to "情報入力を続ける", new_order_path,class:"btn btn-success" %>
 </div>